Title: R Markdown Test
Date: 2013-12-31 23:27:00
Category: News
Status: draft
Tags: book, blog, R
Slug: r-md-test
Author: Bob Rudis (@hrbrmstr)

**R : Irregular Time Series To Hourly Summary**

This bit of R takes an irregular time series generated by attempting to scrape data every
15 minutes from Central Maine Power's web site and then converts it to a regular 15 min
interval series and then aggregates it into an hourly time series for (eventual) use with [this](http://rud.is/outage).

First, we load some necessary timey-wimey packages:

    :::SLexer
    library(zoo)
    library(chron)
    library(xts)


Then we read in one of the irregular time series data sets and strip off seconds and milliseconds (since they aren't useful or helpful for the rest of the operations).


    :::SLexer
    outage.raw <- read.csv("http://rud.is/outage/data/KENNEBEC.csv", stringsAsFactors = FALSE)
    outage.raw$ts <- as.POSIXct(gsub("\\:[0-9]+\\..*$", "", outage.raw$ts), format = "%Y-%m-%d %H:%M")
    str(outage.raw)

    ## 'data.frame':	701 obs. of  2 variables:
    ##  $ ts          : POSIXct, format: "2013-12-03 00:45:00" "2013-12-03 01:45:00" ...
    ##  $ withoutPower: int  0 0 0 0 0 0 0 0 0 0 ...


Now, we convert it to a zoo object and fill in that `zoo` object since `NAs` will cause issues


    :::SLexer
    outage.zoo <- zoo(outage.raw$withoutPower, outage.raw$ts)
    
    complete.zoo <- merge(outage.zoo, zoo(, seq(start(outage.zoo), end(outage.zoo), 
        by = "15 min")), all = TRUE)
    complete.zoo[is.na(complete.zoo)] <- 0
    str(complete.zoo)

    ## 'zoo' series from 2013-12-03 00:45:00 to 2014-01-01 04:15:00
    ##   Data: num [1:2799] 0 0 0 0 0 0 0 0 0 0 ...
    ##   Index:  POSIXct[1:2799], format: "2013-12-03 00:45:00" "2013-12-03 01:00:00" ...


Finally, we aggregate the data to hourly readings and trim the series down to the last 30 days:


    :::SLexer
    hourly.zoo <- last(to.hourly(complete.zoo), "30 days")
    str(hourly.zoo)

    ## 'zoo' series from 2013-12-03 00:45:00 to 2014-01-01 04:15:00
    ##   Data: num [1:701, 1:4] 0 0 0 0 0 0 0 0 0 0 ...
    ##  - attr(*, "dimnames")=List of 2
    ##   ..$ : NULL
    ##   ..$ : chr [1:4] "complete.zoo.Open" "complete.zoo.High" "complete.zoo.Low" "complete.zoo.Close"
    ##   Index:  POSIXct[1:701], format: "2013-12-03 00:45:00" "2013-12-03 01:45:00" ...


Here's a quick graphical overview of the final product


    :::SLexer
    plot(hourly.zoo)

![plot of chunk unnamed-chunk-6](figure/unnamed-chunk-6.png) 


Or, if you prefer `ggplot`:


    :::SLexer
    library(reshape2)
    library(ggplot2)
    library(scales)
    
    df <- data.frame(hourly.zoo)
    df$ts <- as.POSIXct(rownames(df), format = "%Y-%m-%d %H:%M:%S")
    df <- melt(df, c("ts"))



    gg <- ggplot(df, aes(x = ts, y = value))
    gg <- gg + geom_line()
    gg <- gg + scale_x_datetime(breaks = NULL)
    gg <- gg + labs(x = "", y = "")
    gg <- gg + facet_grid(variable ~ .)
    gg <- gg + theme_bw()
    gg <- gg + theme(axis.text.x = element_blank(), axis.ticks.x = element_blank())
    print(gg)

![plot of chunk unnamed-chunk-8](figure/unnamed-chunk-8.png) 

